<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Mazo de cartas</title>
</head>
<body onload="inicio()">

	<table align="center">
		<tr>
			<td><img src="https://acmolino.github.io/recursos/cartas-img/otra/tapa.png" id="imgCarta"></td>
		</tr>
		<tr>
			<td align="center"><button id="btnAccion" onclick="mostrarCarta()">Mostrar</button></td>
		</tr>
		<tr>
			<td align="center"><p>Cartas en el mazo: <span id="cantCartas">48</span></p></td>
		</tr>
	</table>

</body>

<!--Codigo en Javascript-->
<script type="text/javascript">
	//ruta para llamar a la API
	//var ruta = "http://localhost/logosofico/Integrada/cartasAPI"; //Local
	var ruta = "https://cartasapi.vercel.app"; //Online
	var mazo;

	//Inicia el mazo, utilizando variable de session
	async function iniciarMazo(){
	  const response = await fetch(ruta+'/iniciarMazo', 
	    {
	        method: 'GET',
	    });
	    // waits until the request completes...
	    const res = await response.json();
	    return res;       
	}

	function inicio(){
		iniciarMazo().then(dato => {
	    	console.log(dato);
			mazo = dato.ID;
		});	
	}


	async function traerCarta(){
	  const response = await fetch(ruta+'/darCarta/'+mazo, 
	    {
	        method: 'GET',
	    });
	    // waits until the request completes...
	    const res = await response.json();
	    return res;       
	}

	function mostrarCarta(){
		traerCarta().then(dato => {
	    	console.log(dato);
	    	if(dato.restan > 0){
	    		document.getElementById('cantCartas').innerHTML = dato.restan;
		    	var carta = document.getElementById('imgCarta');
		    	carta.src = dato.carta.img;
	    	}else{
	    		 document.getElementById('imgCarta').remove();
	    		 alert("Fin del mazo");
	    		 document.getElementById('btnAccion').innerHTML = "Reiniciar";

	    	}
		});
	}
	
</script>
</html>
